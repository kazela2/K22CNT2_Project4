<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Quáº£n LÃ½ NhÃ¢n ViÃªn</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="sidebar">
    <h2>Quáº£n Trá»‹</h2>
    <a href="#">ğŸ“¦ Quáº£n lÃ½ Doanh Thu</a>
    <a href="#">ğŸ§¾ Quáº£n lÃ½ HÃ³a ÄÆ¡n</a>
    <a href="#">ğŸ‘¥ Quáº£n lÃ½ KhÃ¡ch hÃ ng</a>
    <a href="#">ğŸ“Š Quáº£n LÃ½ NhÃ¢n ViÃªn</a>
  </div>

  <div class="main-content">
    <header>
      <h1>Danh SÃ¡ch NhÃ¢n ViÃªn</h1>
      <button class="logout-btn" onclick="dangXuat()">ÄÄƒng xuáº¥t</button>
    </header>

    <table id="nhanvien-table" class="styled-table">
      <thead>
        <tr>
          <th>MÃ£ NV</th>
          <th>Há» TÃªn</th>
          <th>Vai TrÃ²</th>
          <th>HÃ nh Äá»™ng</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <div class="mt-4">
      <h3>ThÃªm nhÃ¢n viÃªn má»›i</h3>
      <form id="addForm">
        <input type="text" id="hoTen" placeholder="Há» tÃªn" required />
        <select id="vaiTro" required>
          <option value="">Chá»n vai trÃ²</option>
          <option value="NhanVien">NhÃ¢n ViÃªn</option>
          <option value="QuanLy">Quáº£n LÃ½</option>
        </select>
        <button type="submit">Tuyá»ƒn NhÃ¢n TÃ i</button>
      </form>
    </div>
  </div>

  <script>
    // HÃ m táº£i danh sÃ¡ch nhÃ¢n viÃªn
    async function loadNhanVien() {
      try {
        const res = await fetch('http://127.0.0.1:5000/NhanVien/getAll');
        const data = await res.json();

        const tbody = document.querySelector('#nhanvien-table tbody');
        tbody.innerHTML = '';

        data.forEach(nv => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${nv.MaNV}</td>
            <td>${nv.HoTen}</td>
            <td>${nv.VaiTro === 'NhanVien' ? 'NhÃ¢n ViÃªn' : nv.VaiTro === 'QuanLy' ? 'Quáº£n LÃ½' : nv.VaiTro}</td>
            <td><button onclick="xoaNhanVien(${nv.MaNV})">Sa Tháº£i</button></td>
          `;
          tbody.appendChild(row);
        });
      } catch (error) {
        console.error('Lá»—i khi táº£i nhÃ¢n viÃªn:', error);
      }
    }

    // Xá»­ lÃ½ form thÃªm nhÃ¢n viÃªn
    document.getElementById('addForm').addEventListener('submit', async function(e) {
      e.preventDefault();

      const hoTen = document.getElementById('hoTen').value.trim();
      const vaiTro = document.getElementById('vaiTro').value;

      if (!hoTen || !vaiTro) {
        alert('Vui lÃ²ng Ä‘iá»n Ä‘á»§ thÃ´ng tin!');
        return;
      }

      try {
        const res = await fetch('http://127.0.0.1:5000/NhanVien/add', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ HoTen: hoTen, VaiTro: vaiTro })
        });
        const data = await res.json();

        if (data.status === 'success') {
          alert('âœ… ThÃªm nhÃ¢n viÃªn thÃ nh cÃ´ng!');
          loadNhanVien();
          this.reset();
        } else {
          alert('âŒ ThÃªm tháº¥t báº¡i: ' + data.message);
        }
      } catch (err) {
        console.error('Lá»—i thÃªm nhÃ¢n viÃªn:', err);
        alert('CÃ³ lá»—i xáº£y ra khi thÃªm nhÃ¢n viÃªn!');
      }
    });

    // HÃ m xÃ³a nhÃ¢n viÃªn
    async function xoaNhanVien(maNV) {
      if (!confirm('Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n sa tháº£i nhÃ¢n viÃªn nÃ y?')) return;

      try {
        const res = await fetch(`http://127.0.0.1:5000/NhanVien/delete/${maNV}`, {
          method: 'DELETE'
        });
        const data = await res.json();

        if (data.status === 'success') {
          alert('ğŸ—‘ï¸ ÄÃ£ sa tháº£i nhÃ¢n viÃªn.');
          loadNhanVien();
        } else {
          alert('âŒ XÃ³a tháº¥t báº¡i: ' + data.message);
        }
      } catch (err) {
        console.error('Lá»—i xÃ³a nhÃ¢n viÃªn:', err);
        alert('CÃ³ lá»—i xáº£y ra khi xÃ³a nhÃ¢n viÃªn!');
      }
    }

    // Táº£i danh sÃ¡ch khi trang load
    window.addEventListener('DOMContentLoaded', loadNhanVien);

    function dangXuat() {
    // XÃ³a thÃ´ng tin admin khá»i localStorage
    localStorage.removeItem("admin");
  
    // Chuyá»ƒn vá» trang Ä‘Äƒng nháº­p
    window.location.href = "login.html";
  }
  </script>
</body>
</html>
